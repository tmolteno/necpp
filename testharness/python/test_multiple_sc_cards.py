from necpp import *


import unittest


class TestSurfacePatches(unittest.TestCase):

  def handle_nec(self, result):
    if (result != 0):
      print nec_error_message()
    self.assertEqual(result,0)

  ''' CM W2IMU 10GHz F=0.55
      CE ************************************
      SP 0 3 0.019000 -0.001424 0.078830 0.019000 0.001424 0.078830
      SC 0 3 0.019000 0.001424 0.076180 0.019000 -0.001424 0.076180
      SC 0 3 0.019000 0.001424 0.073530 0.019000 -0.001424 0.073530
      SC 0 3 0.019000 0.001424 0.070880 0.019000 -0.001424 0.070880
      SC 0 3 0.019000 0.001424 0.068230 0.019000 -0.001424 0.068230
      SC 0 3 0.019000 0.001424 0.065580 0.019000 -0.001424 0.065580
      SC 0 3 0.019000 0.001424 0.062930 0.019000 -0.001424 0.062930
      SC 0 3 0.019000 0.001424 0.060280 0.019000 -0.001424 0.060280
      SC 0 3 0.019000 0.001424 0.057630 0.019000 -0.001424 0.057630
      SC 0 3 0.019000 0.001424 0.054980 0.019000 -0.001424 0.054980
      SC 0 3 0.019000 0.001424 0.052330 0.019000 -0.001424 0.052330
      SC 0 3 0.019000 0.001424 0.049680 0.019000 -0.001424 0.049680
      SC 0 3 0.019000 0.001424 0.047030 0.019000 -0.001424 0.047030
      SC 0 3 0.019000 0.001424 0.044380 0.019000 -0.001424 0.044380
      SC 0 3 0.019000 0.001424 0.041730 0.019000 -0.001424 0.041730
      SC 0 3 0.019000 0.001424 0.039080 0.019000 -0.001424 0.039080
      SC 0 3 0.019000 0.001424 0.036430 0.019000 -0.001424 0.036430
      SC 0 3 0.017283 0.001295 0.033856 0.017283 -0.001295 0.033856
      SC 0 3 0.015566 0.001167 0.031282 0.015566 -0.001167 0.031282
      SC 0 3 0.013849 0.001038 0.028708 0.013849 -0.001038 0.028708
      SC 0 3 0.012132 0.000909 0.026134 0.012132 -0.000909 0.026134
      SC 0 3 0.010415 0.000780 0.023560 0.010415 -0.000780 0.023560
      SC 0 3 0.010415 0.000780 0.020942 0.010415 -0.000780 0.020942
      SC 0 3 0.010415 0.000780 0.018324 0.010415 -0.000780 0.018324
      SC 0 3 0.010415 0.000780 0.015707 0.010415 -0.000780 0.015707
      SC 0 3 0.010415 0.000780 0.013089 0.010415 -0.000780 0.013089
      SC 0 3 0.010415 0.000780 0.010471 0.010415 -0.000780 0.010471
      SC 0 3 0.010415 0.000780 0.007853 0.010415 -0.000780 0.007853
      SC 0 3 0.010415 0.000780 0.005236 0.010415 -0.000780 0.005236
      SC 0 3 0.010415 0.000780 0.002618 0.010415 -0.000780 0.002618
      SC 0 3 0.010415 0.000780 0.000000 0.010415 -0.000780 0.000000
      SC 0 3 0.007811 0.000585 0.000000 0.007811 -0.000585 0.000000
      SC 0 3 0.005208 0.000390 0.000000 0.005208 -0.000390 0.000000
      SC 0 3 0.002604 0.000195 0.000000 0.002604 -0.000195 0.000000
      SC 0 3 0.000026 0.000002 0.000000 0.000026 -0.000002 0.000000
      GM 0 41 0.000000 0.000000 8.571429
      GW 1 15 0.000000 0.005829 0.004961 0.000000 -0.005829 0.004961 0.000248
      GM 0 0 0.000000 0.000000 0.000000 0.000000 0.000000 -0.078830
      GE
      FR 0 1 0 0 10450.000000
      EX 0 1 8 0 1.000000 0.000000
      LD 5 0 0 0 3.720000E+07
      PT -1
      RP 0 361 3 1500 0.000000 0.000000 1.000000 45.000000
      EN
  '''
  def test_patch(self):
    nec = nec_create()

    self.handle_nec(nec_sp_card(nec, 3, 0.019000, -0.001424, 0.078830, 0.019000, 0.001424, 0.078830))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.076180, 0.019000, -0.001424, 0.076180))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.073530, 0.019000, -0.001424, 0.073530))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.070880, 0.019000, -0.001424, 0.070880))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.068230, 0.019000, -0.001424, 0.068230))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.065580, 0.019000, -0.001424, 0.065580))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.062930, 0.019000, -0.001424, 0.062930))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.060280, 0.019000, -0.001424, 0.060280))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.057630, 0.019000, -0.001424, 0.057630))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.054980, 0.019000, -0.001424, 0.054980))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.052330, 0.019000, -0.001424, 0.052330))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.049680, 0.019000, -0.001424, 0.049680))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.047030, 0.019000, -0.001424, 0.047030))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.044380, 0.019000, -0.001424, 0.044380))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.041730, 0.019000, -0.001424, 0.041730))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.039080, 0.019000, -0.001424, 0.039080))
    self.handle_nec(nec_sc_card(nec, 3, 0.019000, 0.001424, 0.036430, 0.019000, -0.001424, 0.036430))
    self.handle_nec(nec_sc_card(nec, 3, 0.017283, 0.001295, 0.033856, 0.017283, -0.001295, 0.033856))
    self.handle_nec(nec_sc_card(nec, 3, 0.015566, 0.001167, 0.031282, 0.015566, -0.001167, 0.031282))
    self.handle_nec(nec_sc_card(nec, 3, 0.013849, 0.001038, 0.028708, 0.013849, -0.001038, 0.028708))
    self.handle_nec(nec_sc_card(nec, 3, 0.012132, 0.000909, 0.026134, 0.012132, -0.000909, 0.026134))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.023560, 0.010415, -0.000780, 0.023560))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.020942, 0.010415, -0.000780, 0.020942))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.018324, 0.010415, -0.000780, 0.018324))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.015707, 0.010415, -0.000780, 0.015707))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.013089, 0.010415, -0.000780, 0.013089))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.010471, 0.010415, -0.000780, 0.010471))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.007853, 0.010415, -0.000780, 0.007853))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.005236, 0.010415, -0.000780, 0.005236))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.002618, 0.010415, -0.000780, 0.002618))
    self.handle_nec(nec_sc_card(nec, 3, 0.010415, 0.000780, 0.000000, 0.010415, -0.000780, 0.000000))
    self.handle_nec(nec_sc_card(nec, 3, 0.007811, 0.000585, 0.000000, 0.007811, -0.000585, 0.000000))
    self.handle_nec(nec_sc_card(nec, 3, 0.005208, 0.000390, 0.000000, 0.005208, -0.000390, 0.000000))
    self.handle_nec(nec_sc_card(nec, 3, 0.002604, 0.000195, 0.000000, 0.002604, -0.000195, 0.000000))
    self.handle_nec(nec_sc_card(nec, 3, 0.000026, 0.000002, 0.000000, 0.000026, -0.000002, 0.000000))

    self.handle_nec(nec_gm_card(nec, 0,41,0.000000,0.000000,8.571429, 0,0,0,0))
    self.handle_nec(nec_wire(nec, 1,15,0.000000,0.005829,0.004961,0.000000,-0.005829,0.004961,0.000248,1,1))
    self.handle_nec(nec_gm_card(nec, 0,0, 0.000000,0.000000,0.000000, 0.000000,0.000000,-0.078830, 0))
    self.handle_nec(nec_geometry_complete(nec, 0)) # GE
    self.handle_nec(nec_fr_card(nec, 0,1, 10450.000000, 0))
    self.handle_nec(nec_ex_card(nec,0,1,8,0,1.000000,0.000000, 0, 0, 0, 0))
    self.handle_nec(nec_ld_card(nec,5,0,0,0,3.720000E+07, 0, 0))
    self.handle_nec(nec_pt_card(nec,-1, 0, 0, 0))
    self.handle_nec(nec_rp_card(nec, 0,361,3,1,5,0,0,0.000000,0.000000,1.000000,45.000000, 0, 0))
    
    '''
                          ----- ANTENNA INPUT PARAMETERS -----
      TAG   SEG       VOLTAGE (VOLTS)         CURRENT (AMPS)         IMPEDANCE (OHMS)        ADMITTANCE (MHOS)     POWER
      NO.   NO.     REAL      IMAGINARY     REAL      IMAGINARY     REAL      IMAGINARY    REAL       IMAGINARY   (WATTS)
      1     8  1.0000E+00  0.0000E+00  9.2145E-03  6.7375E-04  1.0795E+02 -7.8930E+00  9.2145E-03  6.7375E-04  4.6072E-03
    '''
    self.assertAlmostEqual(nec_impedance_real(nec,0),1.0795E+02,3)
    self.assertAlmostEqual(nec_impedance_imag(nec,0),-7.8930E+00,3)
    self.assertAlmostEqual(nec_gain_max(nec, 0), 10.3332, 4)

    self.handle_nec(nec_delete(nec))


if __name__ == '__main__':
  unittest.main()